require(biomaRt)
if(!require(biomaRt)){
install.packages("biomaRt")
library(biomaRt)
}
if(!require(biomaRt)){
install.packages("biomaRt")
library(biomaRt)
}
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("biomaRt")
listDatasets(mart)
BiocManager::install("biomaRt")
listDatasets(mart)
library(biomaRt)
listDatasets(mart)
listAttributes(mart)
ensmart=useMart("ensembl", dataset="hsapiens_gene_ensembl")
listAttributes(mart)
listAttributes(ensmart)
listDatasets(ensmart)
listAttributes(ensmart)
listAttributes(ensmart, pattern="NCBI")
listAttributes(ensmart, pattern="ncbi")
listAttributes(ensmart, "ncbi")
searchAttributes(mart = ensembl, 'entrez|hgnc')
searchAttributes(mart = ensmart, 'entrez|hgnc')
searchAttributes(mart = ensmart, 'ncbi')
searchAttributes(mart = ensmart, 'NCBI')
searchAttributes(mart = ensmart, 'utr')
present <- "NM_130786.4"
utr_coords<-getBM(attributes=c('HGNC symbol', 'NCBI gene (formerly Entrezgene) ID'
'sequence_3utr_start', 'sequence_3utr_end', '3utr'),
utr_coords<-getBM(attributes=c('HGNC symbol', 'NCBI gene (formerly Entrezgene) ID',
'sequence_3utr_start', 'sequence_3utr_end', '3utr'),
filters='ensembl_transcript_id', values=present, mart=ensmart)
searchAttributes(mart = ensembl, 'entrez|hgnc')
searchAttributes(mart = ensmart, 'entrez|hgnc')
utr_coords<-getBM(attributes=c('hgnc_symbol', 'entrezgene_id',
'entrezgene_trans_name',
'sequence_3utr_start', 'sequence_3utr_end', '3utr'),
filters='ensembl_transcript_id', values=present, mart=ensmart)
utr_coords<-getBM(attributes=c('hgnc_symbol', 'entrezgene_id',
'entrezgene_trans_name',
'3_utr_start', '3_utr_end', '3utr'),
filters='ensembl_transcript_id', values=present, mart=ensmart)
utr_coords<-getBM(attributes=c('hgnc_symbol', 'entrezgene_id',
'entrezgene_trans_name',
'3_utr_start', '3_utr_end', '3utr'),
filters='entrezgene_trans_name', values=present, mart=ensmart)
present <- "A1BG"
utr_coords<-getBM(attributes=c('hgnc_symbol', 'entrezgene_id',
'entrezgene_trans_name',
'3_utr_start', '3_utr_end', '3utr'),
filters='hgnc_symbol', values=present, mart=ensmart)
utr_coords<-getBM(attributes=c('hgnc_symbol', 'entrezgene_id',
'entrezgene_trans_name',
'3_utr_start', '3_utr_end'),
filters='hgnc_symbol', values=present, mart=ensmart)
utr_coords<-getBM(attributes=c('hgnc_symbol',
'3_utr_start', '3_utr_end'),
filters='hgnc_symbol', values=present, mart=ensmart)
utr_coords<-getBM(attributes=c('hgnc_symbol',
'3_utr_start', '3_utr_end'),
filters='hgnc_symbol', values=present, mart=ensmart)
searchAttributes(mart = ensembl, 'utr')
searchAttributes(mart = ensmart, 'utr')
utr_coords<-getBM(attributes=c('hgnc_symbol',
'sequences_3_utr_start', 'sequences_3_utr_end'),
filters='hgnc_symbol', values=present, mart=ensmart)
searchAttributes(mart = ensmart, 'hgnc')
utr_coords<-getBM(attributes=c('hgnc_symbol', 'hgnc_trans_name',
)
)
filters='hgnc_symbol', values=present, mart=ensmart)
utr_coords<-getBM(attributes=c('hgnc_symbol', 'hgnc_trans_name'),
filters='hgnc_symbol', values=present, mart=ensmart)
utr_coords
searchAttributes(mart = ensmart, 'chromosome_name')
listAttributes(mart, "sequences")
listAttributes(ensmart, "sequences")
utr_coords<-getBM(attributes=c('external_gene_name', '5utr', '3utr'),
filters='external_gene_name', values=present, mart=ensmart)
utr_coords
searchAttributes(mart = ensmart, 'utr')
listAttributes(ensmart, "structure")
utr_coords<-getBM(attributes=c('external_gene_name', '5utr', '3utr'),
filters='external_gene_name', values=present, mart=ensmart)
utr_coords
present
utr_coords<-getBM(attributes=c('5utr', '3utr', 'external_gene_name'),
filters='external_gene_name', values=present, mart=ensmart)
utr_coords
getBM(attributes=c(3utr', 'external_gene_name'),
getBM(attributes=c('3utr', 'external_gene_name'),
filters='external_gene_name', values=present, mart=ensmart)
View(utr_coords)
View(utr_coords)
utr_coords$`3utr`
listAttributes(ensmart, "sequences")
utr_coords<-getBM(attributes=c('external_gene_name', '5_utr_start', '5_utr_end'),
filters='external_gene_name', values=present, mart=ensmart)
utr_coords
utr_coords<-getBM(attributes=c('external_gene_name', '5utr'),
filters='external_gene_name', values=present, mart=ensmart)
View(utr_coords)
length(utr_coords$`5utr`)
length(utr_coords[2,`5utr`])
length(utr_coords[2,])
length(utr_coords[2,]$`5utr`)
utr_coords[2,]$`5utr`
58353492 - 58353438
nchar( utr_coords[2,]$`5utr`)
listAttributes(ensmart, "sequences")
utr_coords<-getBM(attributes=c('external_gene_name', '5utr'),
filters='external_gene_name', mart=ensmart)
searchAttributes(mart = ensmart, 'NCBI')
listAttributes(ensmart, "feature_page")
getBM(attributes=c('ensembl_transcript_id','entrezgene_accession'),
filters='entrezgene_accession', values = 'NM_130786.4', mart=ensmart)
getBM(attributes=c('ensembl_transcript_id','entrezgene_accession'),
filters='entrezgene_accession', values = 'NM_130786', mart=ensmart)
searchAttributes(mart = ensmart, 'NCBI')
getBM(attributes=c('external_gene_name', 'ensembl_transcript_id','entrezgene_accession'),
filters='external_gene_name', values = present, mart=ensmart)
searchAttributes(mart = ensmart, 'NCBI')
getBM(attributes=c('external_gene_name', 'ensembl_transcript_id','entrezgene_accession', 'entrezgene_id'),
filters='external_gene_name', values = present, mart=ensmart)
searchAttributes(mart = ensmart, 'accession')
getBM(attributes=c('external_gene_name', 'ensembl_transcript_id','refseq_mrna'),
filters='external_gene_name', values = present, mart=ensmart)
getBM(attributes=c('external_gene_name', 'ensembl_transcript_id','refseq_mrna'),
filters='refseq_mrna', values = 'NR_040112', mart=ensmart)
getBM(attributes=c('external_gene_name', 'ensembl_transcript_id','refseq_mrna'),
filters=c('external_gene_name','refseq_mrna'),
values = c("A1BG", "NM_130786"), mart=ensmart)
getwd()
### reading data
RNA_nucleotide_accession <- read.table("gene2refseq.human.hg38.RNA_nucleotide_accession.txt",
header = TRUE)
RNA_nucleotide_accession
getBM(attributes=c('external_gene_name', 'ensembl_transcript_id','refseq_mrna'),
filters='refseq_mrna'),
getBM(attributes=c('external_gene_name', 'ensembl_transcript_id','refseq_mrna'),
filters='refseq_mrna',
values = RNA_nucleotide_accession, mart=ensmart)
RNA_ensembl_refseq_id <- getBM(attributes=c('external_gene_name', 'ensembl_transcript_id','refseq_mrna'),
filters='refseq_mrna',
values = RNA_nucleotide_accession, mart=ensmart)
RNA_ensembl_refseq_id
searchAttributes(mart = ensmart, 'utr')
listAttributes(ensmart, "sequences")
listAttributes(ensmart, "sequences")
getBM(attributes=c('ensembl_transcript_id', '5_utr_start', '5_utr_end', '5utr',
'3_utr_start', '3_utr_end', '3utr'),
filters='ensembl_transcript_id',
values=RNA_ensembl_refseq_id$ensembl_transcript_id, mart=ensmart)
utr_coords<-getBM(attributes=c('ensembl_transcript_id', '5_utr_start', '5_utr_end', '5utr',
'3_utr_start', '3_utr_end', '3utr'),
filters='ensembl_transcript_id',
values=RNA_ensembl_refseq_id$ensembl_transcript_id, mart=ensmart)
View(utr_coords)
library(biomaRt)
library(dplyr)
ensmart=useMart("ensembl", dataset="hsapiens_gene_ensembl")
chrom <- 21
print(paste0("starting chromsome ", chrom))
listAttributes(ensmart, "sequences")
listAttributes(ensmart, "sequences")
library(biomaRt)
listAttributes(ensmart, "sequences")
ensmart=useMart("ensembl", dataset="hsapiens_gene_ensembl")
listAttributes(ensmart, "sequences")
vcf_file = "gatkCNV_cnvnator_cnv_analysis/Q1777/BS_529GMFX4/2b8b954b-20c3-406b-912a-d3dbaf07e741.mixed_cohort.cnvnator_call.vcf"
vcf <- read.vcfR(vcf_file)
library(vcfR)
v <- vcfR2tidy(vcf, info_only = TRUE)
library(tidyverse)
v <- vcfR2tidy(vcf, info_only = TRUE)
vcf <- read.vcfR(vcf_file)
v <- vcfR2tidy(vcf, info_only = TRUE)
v$fix
v$fix
v
v <- vcfR2tidy(vcf)
v$gt
v$fix
vcf_info <- merge(v$fix, v$gt, by=c("ChromKey","POS"))
vcf_info
v$fix
duplicated(v$fix$POS)
duplicated(v$fix$POS) %>% table()
v$fix %>% select("ChromKey", "POS")
v$fix %>% select("ChromKey", "POS") %>% duplicated() %>% table()
vcf_info
vcf_info %>% mutate(SVLEN = abs(SVLEN), seg.mean = "NA")
vcf_info %>% mutate(SVLEN = abs(SVLEN), seg.mean = NA)
vcf_info <- vcf_info %>% mutate(SVLEN = abs(SVLEN), seg.mean = NA) %>%
select(c("CHROM", "POS", "END", "SVLEN", "gt_CN",
"natorP1", "seg.mean", "SVTYPE"))
vcf_info
chrOrder<-c(paste("chr",1:22,sep=""),"chrX","chrY")
vcf_info$CHROM<-factor(vcf_info$CHROM, levels=chrOrder)
vcf_info
vcf_info[order(vcf_info$chr),]
vcf_info[order(vcf_info$CHROM),]
vcf_info[order(vcf_info$CHROM),] %>% tail()
vcf_info %>% filter(SVLEN = "DEL")
vcf_info %>% filter(vcf_info$SVLEN = "DEL")
vcf_info %>% filter(vcf_info$SVLEN == "DEL")
vcf_info %>% filter(vcf_info$SVTYPE == "DEL")
file_name = "text"
paste0(file_name, ".cnvnator.del.bed")
paste0(file_name, ".cnvnator.dup.bed")
√
2b8b954b-20c3-406b-912a-d3dbaf07e741.mixed_cohort.cnvnator_call.cnvnator.dup.bed
nator_vcf_file
nator_vcf_file <- "gatkCNV_cnvnator_cnv_analysis/Q1777/BS_529GMFX4/2b8b954b-20c3-406b-912a-d3dbaf07e741.mixed_cohort.gatk_gcnv.genotyped_segments.vcf"
vcf <- read.vcfR(nator_vcf_file)
nator_vcf_file <- "gatkCNV_cnvnator_cnv_analysis/Q1777/BS_529GMFX4/2b8b954b-20c3-406b-912a-d3dbaf07e741.mixed_cohort.cnvnator_call.vcf"
vcf <- read.vcfR(nator_vcf_file)
v <- vcfR2tidy(vcf)
vcf_info <- merge(v$fix, v$gt, by = c("ChromKey", "POS"))
vcf_info
cnv_size_cutoff <- 3000
readCNVnatorVcf <- function(nator_vcf_file) {
vcf <- read.vcfR(nator_vcf_file)
v <- vcfR2tidy(vcf)
vcf_info <- merge(v$fix, v$gt, by = c("ChromKey", "POS"))
vcf_info <- vcf_info %>% mutate(SVLEN = abs(SVLEN), seg.mean = NA) %>%
select(c("CHROM", "POS", "END", "SVLEN", "gt_CN",
"natorP1", "seg.mean", "SVTYPE"))
return(vcf_info)
}
nator_cnv <- readCNVnatorVcf(nator_vcf_file)
nator_cnv
nator_cnv %>% select(SVTYPE) %>% table()
nator_cnv %>% filter(nator_cnv$SVTYPE == "DEL" && vcf_info$SVLEN > cnv_size_cutoff)
nator_cnv %>% filter(nator_cnv$SVTYPE == "DEL" && nator_cnv$SVLEN > cnv_size_cutoff)
nator_cnv$SVLEN
str(nator_cnv$SVLEN)
nator_cnv %>% filter(nator_cnv$SVTYPE == "DEL" && nator_cnv$SVLEN > cnv_size_cutoff)
getwd()
setwd()
setwd("D3b-Single-Sample-Variant-Filtering-Workflow/docs/")
setwd("D3b-Single-Sample-Variant-Filtering-Workflow/")
setwd("../D3b-Single-Sample-Variant-Filtering-Workflow/")
setwd("..")
vcf_file <- "chr21.vep_105.vcf.gz"
vcf <- read.vcfR(vcf_file)
library(tidyverse)
library(tidyr)
library(vcfR)
vcf <- read.vcfR(vcf_file)
vcf
v <- vcfR2tidy(vcf, format_fields = "GT"
)
v
v <- vcfR2tidy(vcf, format_fields = "GT")
v <- vcfR2tidy(vcf)
v
v$fix
cols(v$fix)
col(v$fix)
colnames(v$fix)
csqd <- v$meta %>% filter(ID == "CSQ") %>% select(Description)
csqd <- unlist(str_split(gsub("Consequence annotations from Ensembl VEP. Format: ", "", csqd$Description), "\\|"))
annd <- v$meta %>% filter(ID == "ANN") %>% select(Description)
annd <- unlist(str_split(gsub("'", "", gsub(" ","" ,gsub("Functional annotations: ", "", annd$Description))), "\\|"))
annd
annd
csqd
CSQ <- v$fix %>%
separate_rows(CSQ, sep = ",") %>%
separate(CSQ, csqd, sep = "\\|", convert = TRUE) %>%
filter(str_detect(Feature, "ENST")) %>%
unite("VariantID", c(CHROM, POS, REF, ALT), sep = "-", remove = FALSE) %>%
unite("key", ChromKey, POS, sep = "-", remove = FALSE) %>%
select(-c(ANN))
CSQ
CSQ <- v$fix %>%
separate_rows(CSQ, sep = ",") %>%
separate(CSQ, csqd, sep = "\\|", convert = TRUE) %>%
filter(str_detect(Feature, "ENST")) %>%
unite("VariantID", c(CHROM, POS, REF, ALT), sep = "-", remove = FALSE) %>%
unite("key", ChromKey, POS, sep = "-", remove = FALSE)
ANN <- 	v$fix %>%
unite("VariantID", c(CHROM, POS, REF, ALT), sep = "-", remove = FALSE) %>%
select("VariantID", "ANN") %>%
separate_rows(ANN, sep = ",") %>%
separate(ANN, annd, sep = "\\|", convert = TRUE) %>%
filter(str_detect(Feature_ID, "ENST")) %>%
mutate(Feature_ID = str_extract(as.character(Feature_ID), "ENST[0-9]+"))
is.null(csqd)
is.null(ANN)
is.null(annd)
!is.null(csqd)
!is.null(csqd) | !is.null(annd)
is.null(annd)
!is.null(csqd)
annd
is.null(annd)
!is.null(csqd) | !is.null(annd)
if(!is.null(csqd) | !is.null(annd) ){
if(!is.null(csqd))
{vf <- CSQ}
else
{vf <- ANN}
}
else{
if(!is.null(csqd) | !is.null(annd) ){
if(!is.null(csqd)){
vf <- CSQ}
else{
vf <- ANN}
}
else{
if(is.null(csqd)){
vf <- ANN}
else{
vf <- CSQ}
if(is.null(csqd)){
vf <- ANN
} else{
vf <- CSQ
}
vf
gt <- v$gt %>% unite("key", ChromKey, POS, sep = "-", remove = FALSE)
gt
vf
variants <- vf %>% left_join(gt, by = "key") %>% select(Indiv, everything()) %>% select(-contains(".y"))
variants
colnames(variants)
variants$ENSP
colnames(variants)
colnames(variants) <- gsub("\.x", "", colnames(variants))
colnames(variants) <- gsub(".x", "", colnames(variants))
colnames(variants)
variants <- variants %>% rename(chromosome = CHROM)
colnames(variants)
variants <- vf %>% left_join(gt, by = "key") %>% select(Indiv, everything()) %>% select(-contains(".y"))
variants <- variants %>% rename(chromosome = CHROM, start = POS, reference = REF,
alternate = ALT, quality, QUAL)
variants <- variants %>% rename(chromosome = CHROM, start = POS.x, reference = REF,
alternate = ALT, quality, QUAL)
variants <- variants %>% rename(chromosome = CHROM, start = POS.x, reference = REF,
alternate = ALT, quality = QUAL)
variants
colnames(variants)
readVcf <- function(vcf_file) {
vcf <- read.vcfR(vcf_file)
v <- vcfR2tidy(vcf)
csqd <- v$meta %>% filter(ID == "CSQ") %>% select(Description)
csqd <- unlist(str_split(gsub("Consequence annotations from Ensembl VEP. Format: ", "", csqd$Description), "\\|"))
annd <- v$meta %>% filter(ID == "ANN") %>% select(Description)
annd <- unlist(str_split(gsub("'", "", gsub(" ","" ,gsub("Functional annotations: ", "", annd$Description))), "\\|"))
if(!is.null(csqd)){
CSQ <- v$fix %>%
separate_rows(CSQ, sep = ",") %>%
separate(CSQ, csqd, sep = "\\|", convert = TRUE) %>%
filter(str_detect(Feature, "ENST")) %>%
unite("VariantID", c(CHROM, POS, REF, ALT), sep = "-", remove = FALSE) %>%
unite("key", ChromKey, POS, sep = "-", remove = FALSE)
}
if(!is.null(annd)){
ANN <- 	v$fix %>%
unite("VariantID", c(CHROM, POS, REF, ALT), sep = "-", remove = FALSE) %>%
select("VariantID", "ANN") %>%
separate_rows(ANN, sep = ",") %>%
separate(ANN, annd, sep = "\\|", convert = TRUE) %>%
filter(str_detect(Feature_ID, "ENST")) %>%
mutate(Feature_ID = str_extract(as.character(Feature_ID), "ENST[0-9]+"))
}
if(is.null(csqd)){
vf <- ANN
} else{
vf <- CSQ
}
gt <- v$gt %>% unite("key", ChromKey, POS, sep = "-", remove = FALSE)
variants <- vf %>% left_join(gt, by = "key") %>% select(Indiv, everything()) %>% select(-contains(".y"))
variants <- variants %>% rename(chromosome = CHROM, start = POS.x, reference = REF,
alternate = ALT, quality = QUAL)
return(variants)
}
vcf_file <- "9d1d5292-5c52-4132-8b9d-66fb485a056c.gatk.hardfiltered.PASS.vcf.gz.hg38_multianno.vcf.gz"
variants_list <- readVcf（vcf
variants_list <- readVcf(vcf_file)
variants_list$Func.refGene
variants_list %>% filter(Func.refGene.contains(x3))
variants_list %>% filter(Func.refGene == "UTR5\x3bUTR3")
variants_list %>% filter(Func.refGene == "UTR5\\x3bUTR3")
variants_list %>% filter(Func.refGene == "UTR5\\x3bUTR3") %>% select(Func.refGene)
variants_list <- variants_list %>% mutate_all(funs(str_replace_all(., "\\x3b", ";")))
variants_list %>% filter(Func.refGene == "UTR5\\x3bUTR3") %>% select(Func.refGene)
library(dplyr)
library(stringr)
# Sample data frame
df <- data.frame(
Col_A = c("apple pie", "banana split", "cherry tart"),
Col_B = c("apple juice", "banana smoothie", "cherry soda")
)
# Original data frame
print(df)
# Replace "apple" with "orange" in all columns and rows
df <- df %>%
mutate_all(funs(str_replace_all(., "apple", "orange")))
# Updated data frame with pattern replaced
print(df)
df <- df %>%
mutate_all(~ str_replace_all(., "apple", "orange"))
variants_list <- variants_list %>% mutate_all(~ str_replace_all(., "\\x3b", ";"))
variants_list %>% filter(Func.refGene == "UTR5\\x3bUTR3") %>% select(Func.refGene)
variants_list <- variants_list %>% mutate_all(~ str_replace_all(., "\x3b", ";"))
variants_list %>% filter(Func.refGene == "UTR5\\x3bUTR3") %>% select(Func.refGene)
variants_list <- variants_list %>% mutate_all(~ str_replace_all(., "UTR5", ";"))
variants_list %>% filter(Func.refGene == "UTR5\\x3bUTR3") %>% select(Func.refGene)
variants_list %>% filter(Func.refGene == ";\\x3bUTR3") %>% select(Func.refGene)
variants_list <- variants_list %>%
mutate_all(~ str_replace_all(., "\\\\x3b", ";"))
variants_list %>% filter(Func.refGene == ";\\x3bUTR3") %>% select(Func.refGene)
variants_list %>% filter(Func.refGene == ";;bUTR3") %>% select(Func.refGene)
variants_list %>% filter(Func.refGene == ";;;UTR3") %>% select(Func.refGene)
variants_list %>% filter(Func.refGene == ";;UTR3") %>% select(Func.refGene)
readVcf <- function(vcf_file) {
vcf <- read.vcfR(vcf_file)
v <- vcfR2tidy(vcf)
csqd <- v$meta %>% filter(ID == "CSQ") %>% select(Description)
csqd <- unlist(str_split(gsub("Consequence annotations from Ensembl VEP. Format: ", "", csqd$Description), "\\|"))
annd <- v$meta %>% filter(ID == "ANN") %>% select(Description)
annd <- unlist(str_split(gsub("'", "", gsub(" ","" ,gsub("Functional annotations: ", "", annd$Description))), "\\|"))
if(!is.null(csqd)){
CSQ <- v$fix %>%
separate_rows(CSQ, sep = ",") %>%
separate(CSQ, csqd, sep = "\\|", convert = TRUE) %>%
filter(str_detect(Feature, "ENST")) %>%
unite("VariantID", c(CHROM, POS, REF, ALT), sep = "-", remove = FALSE) %>%
unite("key", ChromKey, POS, sep = "-", remove = FALSE)
}
if(!is.null(annd)){
ANN <- 	v$fix %>%
unite("VariantID", c(CHROM, POS, REF, ALT), sep = "-", remove = FALSE) %>%
select("VariantID", "ANN") %>%
separate_rows(ANN, sep = ",") %>%
separate(ANN, annd, sep = "\\|", convert = TRUE) %>%
filter(str_detect(Feature_ID, "ENST")) %>%
mutate(Feature_ID = str_extract(as.character(Feature_ID), "ENST[0-9]+"))
}
if(is.null(csqd)){
vf <- ANN
} else{
vf <- CSQ
}
gt <- v$gt %>% unite("key", ChromKey, POS, sep = "-", remove = FALSE)
variants <- vf %>% left_join(gt, by = "key") %>% select(Indiv, everything()) %>% select(-contains(".y"))
variants <- variants %>% rename(chromosome = CHROM, start = POS.x, reference = REF,
alternate = ALT, quality = QUAL) %>%
select(-key, -ChromKey.x, -VariantID) %>%
mutate_all(~ str_replace_all(., "\\\\x3b", ";")) %>%
mutate_all(~ str_replace_all(., "\\\\x3d", "="))
return(variants)
}
variants_list <- readVcf(vcf_file)
variants_list %>% select(Func.refGene) %>% distinct()
